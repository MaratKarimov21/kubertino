# Kubertino Configuration File
# Copy this file to ~/.kubertino.yml and customize for your environment

version: "1.0"

# Optional: Override default kubeconfig path
kubeconfig: ~/.kube/config

# Global actions (available for all contexts)
# These actions are available in every context and can be overridden by per-context actions
actions:
  - name: "View Logs"
    shortcut: "l"
    command: "kubectl logs -n {{.namespace}} {{.pod}} -f --tail=100"

  - name: "Port Forward"
    shortcut: "p"
    command: "kubectl port-forward -n {{.namespace}} {{.pod}} 8080:8080"

  - name: "Describe Pod"
    shortcut: "i"
    command: "kubectl describe pod -n {{.namespace}} {{.pod}}"

# Favorite namespaces - Format A: Per-context map
# Favorites are displayed at the top of the namespace list
favorites:
  production:
    - default
    - api
    - workers
    - monitoring
  staging:
    - default
    - staging-api
  minikube:
    - default
    - dev

# Alternative: Global favorites list (uncomment to use instead of per-context)
# favorites:
#   - my-namespace
#   - another-namespace

contexts:
  # Production context
  - name: production
    # Default regex pattern for matching pods
    # This determines which pod is selected when an action doesn't specify pod_pattern
    default_pod_pattern: "^api-.*"

    # Per-context actions (optional, extend/override global actions)
    actions:
      - name: "Rails Console"
        shortcut: "c"
        command: "kubectl exec -n {{.namespace}} {{.pod}} -it -- bundle exec rails console"
        pod_pattern: "^api-.*"

      - name: "Bash Shell"
        shortcut: "b"
        command: "kubectl exec -n {{.namespace}} {{.pod}} -it -- /bin/bash"
        pod_pattern: "^api-.*"

      - name: "Grafana Dashboard"
        shortcut: "g"
        command: "open https://grafana.example.com/d/pod-metrics?var-pod={{.pod}}&var-namespace={{.namespace}}"

      - name: "Kibana Logs"
        shortcut: "k"
        command: "open https://kibana.example.com/app/discover#/?_g=(filters:!((pod:'{{.pod}}')))"

  # Staging context
  - name: staging
    default_pod_pattern: "^web-.*"
    actions:
      - name: "Shell"
        shortcut: "s"
        command: "kubectl exec -n {{.namespace}} {{.pod}} -it -- /bin/sh"

      - name: "Debug Shell"
        shortcut: "d"
        command: "kubectl exec -n {{.namespace}} {{.pod}} -it -- /bin/bash -l"

      - name: "Staging Dashboard"
        shortcut: "g"
        command: "open https://dashboard.staging.example.com/{{.context}}/{{.namespace}}"

  # Development context (local minikube/kind)
  - name: minikube
    default_pod_pattern: ".*"
    actions:
      - name: "Shell"
        shortcut: "s"
        command: "kubectl exec -n {{.namespace}} {{.pod}} -it -- /bin/sh"

      - name: "Local Logs"
        shortcut: "v"
        command: "kubectl logs -n {{.namespace}} {{.pod}} -f"

# Template Variables Available in Commands:
# {{.context}}    - Current Kubernetes context name
# {{.namespace}}  - Selected namespace
# {{.pod}}        - Selected pod name (matched by pod_pattern or default_pod_pattern)
#
# Examples:
# - kubectl exec: "kubectl exec -n {{.namespace}} {{.pod}} -it -- /bin/bash"
# - kubectl logs: "kubectl logs -n {{.namespace}} {{.pod}} -f --tail=100"
# - Open URL: "open https://dashboard.example.com/{{.context}}/{{.namespace}}"
# - Port forward: "kubectl port-forward -n {{.namespace}} {{.pod}} 3000:3000"
# - Local script: "./scripts/debug.sh {{.context}} {{.namespace}} {{.pod}}"
